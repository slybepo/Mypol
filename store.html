<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DreamWeave Store</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #0f172a;
      color: #e0f2fe;
      margin: 0;
      padding: 0;
    }
    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background-color: #1e293b;
    }
    nav .logo {
      height: 50px;
    }
    nav ul {
      list-style: none;
      display: flex;
      gap: 15px;
    }
    nav ul li a {
      color: #e0f2fe;
      text-decoration: none;
    }
    .hero {
      text-align: center;
      padding: 50px 20px;
    }
    .category-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      padding: 20px;
    }
    .category-card {
      position: relative;
      width: 250px;
      height: 150px;
      background-size: cover;
      background-position: center;
      border-radius: 10px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.3s;
    }
    .category-card:hover {
      transform: translateY(-5px);
    }
    .category-card h3 {
      position: absolute;
      bottom: 10px;
      right: 10px;
      margin: 0;
      color: white;
      background: rgba(0, 0, 0, 0.5);
      padding: 5px 10px;
      border-radius: 5px;
    }
    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #22c55e;
      color: #fff;
      padding: 15px 20px;
      border-radius: 10px;
      display: none;
    }
    .notification.show {
      display: flex;
    }
    .dropdown-menu {
      position: absolute;
      top: 100%;
      right: 0;
      background: #1e293b;
      display: none;
      flex-direction: column;
      border: 1px solid #334155;
    }
    .dropdown-menu a {
      padding: 10px;
      color: #e0f2fe;
      text-decoration: none;
    }
    .dropdown-visible {
      display: flex;
    }
    @media (max-width: 768px) {
      .category-card {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <nav>
    <img src="https://i.ibb.co/FzRdYp0/logo-generator-image-removebg-preview-1.png" class="logo">
    <ul>
      <li><a href="#home">Home</a></li>
      <li id="login-btn"><a href="#">Login with Discord</a></li>
      <li id="logout-btn" style="display: none;"><a href="#">Logout</a></li>
      <li id="profile-link" style="display: none;">
        <a href="#">Profile</a>
        <div id="dropdown-menu">
          <a href="#">My Profile</a>
          <a href="#" id="admin-label" style="display: none;">Admin Panel</a>
        </div>
      </li>
    </ul>
  </nav>

  <div class="hero">
    <h1 id="welname">Welcome to DreamWeave Store</h1>
    <p>Your go-to place for exclusive products.</p>
  </div>

  <div class="category-container" id="categories"></div>

  <div id="notification" class="notification">
    <span id="notification-text"></span>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "YOUR_FIREBASE_API_KEY",
      authDomain: "YOUR_FIREBASE_AUTH_DOMAIN",
      databaseURL: "YOUR_FIREBASE_DATABASE_URL",
      projectId: "YOUR_FIREBASE_PROJECT_ID",
      storageBucket: "YOUR_FIREBASE_STORAGE_BUCKET",
      messagingSenderId: "YOUR_FIREBASE_MESSAGING_SENDER_ID",
      appId: "YOUR_FIREBASE_APP_ID"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const DISCORD_CLIENT_ID = '1227271362264043681';
    const DISCORD_REDIRECT_URI = 'https://saphireshop.xyz';
    const GUILD_ID = '1194870692647293009';
    const MOD_ROLE_ID = '1319962253453430804';

    const DISCORD_AUTH_URL = `https://discord.com/api/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&redirect_uri=${encodeURIComponent(DISCORD_REDIRECT_URI)}&response_type=token&scope=identify%20guilds%20guilds.members.read`;

    const loginBtn = document.getElementById('login-btn');
    const profileLink = document.getElementById('profile-link');
    const dropdownMenu = document.getElementById('dropdown-menu');
    const adminLabel = document.getElementById('admin-label');
    const logoutBtn = document.getElementById('logout-btn');
    const wname = document.getElementById('welname');

    loginBtn.addEventListener('click', () => {
      window.location.href = DISCORD_AUTH_URL;
    });

    profileLink.addEventListener('click', () => {
      dropdownMenu.classList.toggle('dropdown-visible');
    });

    function checkToken() {
      const hash = window.location.hash;
      if (hash) {
        const params = new URLSearchParams(hash.slice(1));
        const token = params.get('access_token');
        if (token) {
          localStorage.setItem('discord_token', token);
          fetchUserInfo(token);
          fetchUserGuilds(token);
        }
      }
    }

    async function fetchUserInfo(token) {
      try {
        const response = await fetch('https://discord.com/api/users/@me', {
          headers: { Authorization: `Bearer ${token}` },
        });
        const user = await response.json();
        wname.textContent = `Welcome back, ${user.username} ðŸ‘‹`;

        profileLink.querySelector('a').innerHTML = `<img src="https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png" alt="Avatar" style="width: 30px; height: 30px; border-radius: 50%;"> ${user.username}`;
        loginBtn.style.display = 'none';
        profileLink.style.display = 'block';
        logoutBtn.style.display = 'block';
      } catch (err) {
        console.error('Error fetching user info:', err);
      }
    }

    async function fetchUserGuilds(token) {
      try {
        const response = await fetch(`https://discord.com/api/users/@me/guilds/${GUILD_ID}/member`, {
          headers: { Authorization: `Bearer ${token}` },
        });
        const guildMember = await response.json();

        if (guildMember.roles.includes(MOD_ROLE_ID)) {
          adminLabel.style.display = 'block';
        }
      } catch (err) {
        console.error('Error fetching guild info:', err);
      }
    }

    logoutBtn.addEventListener('click', () => {
      localStorage.removeItem('discord_token');
      window.location.reload();
    });

    window.addEventListener('DOMContentLoaded', () => {
      const token = localStorage.getItem('discord_token');
      if (token) {
        fetchUserInfo(token);
        fetchUserGuilds(token);
      } else {
        checkToken();
      }
    });

    function loadCategories() {
      const categoryRef = db.ref('categories');
      categoryRef.on('value', (snapshot) => {
        const categories = snapshot.val();
        const container = document.getElementById('categories');
        container.innerHTML = '';
        for (const key in categories) {
          const { name, thumbnail } = categories[key];
          const div = document.createElement('div');
          div.className = 'category-card';
          div.style.backgroundImage = `url(${thumbnail})`;
          div.innerHTML = `<h3>${name}</h3>`;
          container.appendChild(div);
        }
      });
    }

    loadCategories();
  </script>
</body>
</html>
